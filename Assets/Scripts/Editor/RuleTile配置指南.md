# Rule Tile 配置指南

## 概述

Rule Tile 是 Unity 2D Tilemap Extras 包中的一个强大工具，它允许您基于邻居瓦片的配置自动选择合适的精灵。这使得创建复杂的瓦片地图变得更加简单和智能。

## 安装 Rule Tile

1. 打开 Unity Package Manager (Window > Package Manager)
2. 选择 "Unity Registry"
3. 搜索 "2D Tilemap Extras"
4. 点击 "Install" 安装包

## 创建 Rule Tile 资产

### 方法一：通过菜单创建
1. 在 Project 窗口中右键点击
2. 选择 Create > 2D > Tiles > Rule Tile
3. 重命名您的 Rule Tile 资产

### 方法二：通过脚本创建
```csharp
[CreateAssetMenu(fileName = "New Rule Tile", menuName = "Tiles/Rule Tile")]
public class CustomRuleTile : RuleTile
{
    // 自定义逻辑
}
```

## Rule Tile 基本配置

### 1. 默认设置 (Default Settings)

#### Default Sprite (默认精灵)
- **用途**: 当没有规则匹配时显示的精灵
- **建议**: 选择一个代表性的、中性的精灵
- **示例**: 草地瓦片的中央部分

#### Default GameObject (默认游戏对象)
- **用途**: 当瓦片被放置时实例化的游戏对象
- **使用场景**: 需要附加脚本或组件的瓦片
- **注意**: 可选项，大多数情况下留空

#### Default Collider Type (默认碰撞器类型)
- **None**: 无碰撞器
- **Sprite**: 基于精灵形状的碰撞器
- **Grid**: 矩形网格碰撞器

### 2. 瓦片规则 (Tiling Rules)

#### 规则组成
每个规则包含以下部分：
- **邻居模式**: 3x3 网格定义邻居要求
- **输出精灵**: 匹配时显示的精灵
- **变换**: 精灵的旋转和镜像设置

#### 邻居模式符号
- **绿色箭头**: 该位置必须有相同类型的瓦片
- **红色 X**: 该位置不能有相同类型的瓦片
- **空白**: 忽略该位置的瓦片状态

#### 输出类型 (Output Types)

##### Single (单一精灵)
- 固定显示一个精灵
- 最常用的类型
- 适用于边缘、角落等固定形状

##### Random (随机精灵)
- 从多个精灵中随机选择一个
- 用于增加视觉变化
- 适用于草地、石头等自然纹理

##### Animation (动画序列)
- 播放精灵动画序列
- 用于水流、火焰等动态效果
- 需要设置动画速度

#### 变换类型 (Transform Types)

##### Fixed (固定)
- 精灵不进行任何变换
- 用于有明确方向性的瓦片

##### Rotated (旋转)
- 允许精灵旋转以匹配不同方向
- 用于管道、道路等可旋转的瓦片

##### Mirror (镜像)
- 允许精灵镜像翻转
- MirrorX: 水平镜像
- MirrorY: 垂直镜像
- MirrorXY: 双向镜像

## 常见配置模式

### 1. 平台瓦片配置

#### 基本边缘规则
```
规则 1: 左边缘
[ ][ ][X]
[ ][T][ ]
[ ][ ][X]
精灵: 左边缘精灵

规则 2: 右边缘
[X][ ][ ]
[ ][T][ ]
[X][ ][ ]
精灵: 右边缘精灵

规则 3: 顶边缘
[ ][X][ ]
[ ][T][ ]
[ ][ ][ ]
精灵: 顶边缘精灵
```

#### 角落规则
```
规则 4: 左上角
[ ][ ][ ]
[ ][T][ ]
[ ][ ][X]
精灵: 左上角精灵

规则 5: 右上角
[ ][ ][ ]
[ ][T][ ]
[X][ ][ ]
精灵: 右上角精灵
```

### 2. 自然地形配置

#### 草地瓦片
```
规则 1: 完全被包围
[ ][ ][ ]
[ ][T][ ]
[ ][ ][ ]
输出: Random (多个草地变体)

规则 2: 边缘草地
[ ][X][ ]
[ ][T][ ]
[ ][ ][ ]
输出: Single (边缘草地精灵)
```

### 3. 管道/道路配置

#### 直线和转弯
```
规则 1: 水平直线
[ ][ ][ ]
[ ][T][ ]
[ ][ ][ ]
变换: Rotated

规则 2: L型转弯
[ ][ ][ ]
[ ][T][ ]
[ ][ ][ ]
变换: Rotated
```

## 高级技巧

### 1. 规则优先级
- 规则按从上到下的顺序检查
- 更具体的规则应该放在前面
- 通用规则放在后面作为后备

### 2. 性能优化
- 避免过多的规则
- 使用变换减少重复规则
- 合理使用随机输出

### 3. 调试技巧
- 使用 Rule Tile Editor 预览规则
- 在场景中测试不同配置
- 使用 Debug.Log 输出匹配信息

## 自定义 Inspector 功能

我们的自定义 Inspector 提供了以下增强功能：

### 1. 中文界面
- 所有属性都有中文标签
- 详细的使用说明
- 直观的图标和提示

### 2. 规则统计
- 显示总规则数量
- 按类型分类统计
- 规则预览功能

### 3. 快速访问
- 一键打开 Rule Tile Editor
- 直接访问相关文档
- 使用提示和最佳实践

### 4. 可视化信息
- 规则缩略图预览
- 邻居位置计数
- 旋转信息显示

## 常见问题解决

### Q: 规则不生效怎么办？
A: 
1. 检查规则顺序
2. 确认邻居模式设置正确
3. 验证精灵是否正确分配
4. 检查 Tilemap Collider 设置

### Q: 如何创建复杂的地形？
A:
1. 从简单规则开始
2. 逐步添加边缘和角落规则
3. 使用变换减少重复工作
4. 测试所有可能的邻居组合

### Q: 性能问题如何解决？
A:
1. 减少不必要的规则
2. 使用 Tilemap Collider 2D 而不是单独的碰撞器
3. 合并相似的瓦片
4. 使用 Composite Collider 2D

## 最佳实践

1. **规划先行**: 在创建规则前先画出所有可能的瓦片组合
2. **模块化设计**: 为不同类型的地形创建单独的 Rule Tile
3. **测试驱动**: 频繁测试规则在实际场景中的表现
4. **文档记录**: 为复杂的规则添加注释和说明
5. **版本控制**: 保存 Rule Tile 的不同版本以便回滚

## 扩展资源

- [Unity 2D Tilemap Extras 官方文档](https://docs.unity3d.com/Packages/com.unity.2d.tilemap.extras@latest)
- [Unity Tilemap 系统指南](https://docs.unity3d.com/Manual/class-Tilemap.html)
- [2D 游戏开发最佳实践](https://unity.com/how-to/2D-game-art-design)

---

*本指南基于 Unity 2022.3 LTS 版本编写，某些功能可能在不同版本中有所差异。*