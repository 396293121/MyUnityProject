# 技能系统重构说明

## 概述

本次重构将技能效果逻辑从 `SkillManager` 移动到 `skillDataConfig` 中实现，创建了一个更加模块化和可扩展的技能系统。

## 系统架构

### 核心组件

1. **skillDataConfig.cs** - 技能数据配置类
   - 包含所有技能参数配置
   - 实现具体的技能效果逻辑
   - 支持多种技能类型和目标类型

2. **SkillManager.cs** - 技能管理器
   - 处理技能输入检测
   - 管理技能冷却和法力消耗
   - 播放技能动画、特效和音效
   - 委托技能效果执行给 skillDataConfig

3. **BuffManager.cs** - BUFF管理器
   - 管理增益/减益效果
   - 自动处理BUFF过期
   - 计算总属性加成

4. **SkillExamples.cs** - 技能配置示例
   - 提供各种技能类型的配置示例
   - 包含调试和测试功能

## 支持的技能类型

### 1. 单体攻击 (SingleTarget)
- 自动寻找最近的有效目标
- 对单个目标造成伤害
- 适用于基础攻击技能

### 2. 范围伤害 (AreaOfEffect)
- 支持圆形和矩形AOE
- 可配置AOE大小和形状
- 对范围内所有有效目标造成伤害

### 3. 增益BUFF (Buff)
- 为施法者添加临时属性加成
- 支持攻击力和移动速度加成
- 自动管理BUFF持续时间

### 4. 治疗 (Heal)
- 恢复施法者生命值
- 可扩展支持治疗其他目标

### 5. 召唤 (Summon)
- 召唤临时单位
- 自动管理召唤物生存时间
- 支持各种召唤物类型

## 目标类型

- **Enemy** - 敌人
- **Self** - 自己
- **Ally** - 友军
- **All** - 所有单位

## 使用方法

### 1. 创建技能资产

1. 在Project窗口右键
2. 选择 `Create > Skills > Skill Data`
3. 命名技能资产

### 2. 配置技能参数

#### 基础信息
- **技能名称**: 技能的显示名称
- **技能图标**: 技能的UI图标
- **技能描述**: 技能的详细说明

#### 属性配置
- **伤害值**: 技能造成的伤害
- **冷却时间**: 技能的冷却时间（秒）
- **法力消耗**: 使用技能消耗的法力值
- **技能范围**: 技能的作用范围

#### 特效配置
- **技能特效预制体**: 技能释放时的视觉特效
- **技能音效**: 技能释放时的音效

#### 动画配置
- **技能动画触发器**: Animator Controller中的触发器名称
- **动画持续时间**: 技能动画的播放时间

#### 技能效果
- **技能类型**: 选择技能的效果类型
- **目标类型**: 选择技能的目标类型
- 根据技能类型显示相应的配置选项

### 3. 配置Animator Controller

1. 在Animator Controller中添加技能动画状态
2. 创建对应的触发器参数
3. 设置状态转换条件

### 4. 添加到技能管理器

1. 选择包含SkillManager组件的GameObject
2. 在Inspector中找到"可用技能列表"
3. 将创建的技能资产拖拽到列表中

## 技能配置示例

### 战士基础攻击
```
技能类型: 单体攻击
目标类型: 敌人
伤害值: 50
冷却时间: 2秒
法力消耗: 10
技能范围: 3
动画触发器: warrior_attack1
```

### 战士旋风斩
```
技能类型: 范围伤害
目标类型: 敌人
伤害值: 80
冷却时间: 8秒
法力消耗: 40
技能范围: 5
AOE形状: 圆形
动画触发器: warrior_whirlwind
```

### 战士狂暴
```
技能类型: 增益BUFF
目标类型: 自己
冷却时间: 30秒
法力消耗: 50
BUFF持续时间: 15秒
攻击力加成: 30
移动速度加成: 0.3
动画触发器: warrior_berserk
```

## 扩展指南

### 添加新的技能类型

1. 在 `SkillType` 枚举中添加新类型
2. 在 `skillDataConfig.cs` 中添加相应的配置字段
3. 在 `ExecuteSkillEffect` 方法中添加新的case分支
4. 实现具体的技能效果逻辑

### 添加新的目标类型

1. 在 `TargetType` 枚举中添加新类型
2. 更新 `IsValidTarget` 和 `GetTargetLayerMask` 方法
3. 确保相应的Tag和Layer已正确设置

### 自定义BUFF效果

1. 在 `BuffEffect` 类中添加新的属性字段
2. 更新 `BuffManager` 的相关方法
3. 在角色控制器中应用BUFF效果

## 调试功能

### SkillExamples组件
- 提供各种技能配置示例
- 包含技能系统测试功能
- 可以快速验证技能配置

### BuffManager调试
- 实时显示当前BUFF状态
- 提供测试BUFF的按钮
- 显示总属性加成

## 注意事项

1. **Layer和Tag设置**: 确保敌人、玩家等GameObject设置了正确的Layer和Tag
2. **动画配置**: 技能动画触发器名称必须与Animator Controller中的参数名称一致
3. **特效管理**: 技能特效会在2秒后自动销毁，可根据需要调整
4. **性能考虑**: 大量AOE技能可能影响性能，建议合理设置检测范围
5. **BUFF叠加**: 同名BUFF会刷新持续时间，不会叠加效果

## 最佳实践

1. **命名规范**: 使用清晰的技能名称和动画触发器名称
2. **参数平衡**: 合理设置伤害、冷却时间和法力消耗
3. **视觉反馈**: 为每个技能配置合适的特效和音效
4. **测试验证**: 使用SkillExamples组件测试技能配置
5. **文档记录**: 为自定义技能编写配置说明

## 故障排除

### 技能无法释放
- 检查法力值是否足够
- 确认技能是否在冷却中
- 验证SkillManager组件是否正确配置

### 动画不播放
- 检查Animator组件是否存在
- 确认触发器名称是否正确
- 验证Animator Controller配置

### 技能效果无效
- 检查目标Layer和Tag设置
- 确认技能范围配置
- 验证目标类型选择

### BUFF不生效
- 确认BuffManager组件已添加
- 检查BUFF配置参数
- 验证角色控制器集成